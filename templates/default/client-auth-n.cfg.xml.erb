<?xml version="1.0" encoding="UTF-8"?>

<client-auth xmlns="http://docs.rackspacecloud.com/repose/client-auth/v1.0">

    <!-- Automatically generated by Chef, do not modify -->

    <% if @auth_provider == 'RACKSPACE' %>

    <rackspace-auth delegable="false" request-groups="false" xmlns="http://docs.rackspacecloud.com/repose/client-auth/rs-auth-1.1/v1.0">
        <authentication-server username="<%= @username %>" password="<%= @password %>" uri="<%= @auth_uri %>" />

        <% if @mapping_regex %>
        <account-mapping id-regex="<%= @mapping_regex %>" type="<%= @mapping_type %>"/>
        <% end %>

        <!-- Example Regex to capture user identity in uri
            e.g: /v1/usertest1/action => x-pp-user=usertest1
            e.g: /v1/853473/action => x-pp-user=853473
            e.g: /v1/-741057/action => x-pp-user=-741057
            e.g: /v1/reposeuser/action => x-pp-user=reposeuser
            -->
        <account-mapping id-regex=".*/v1/([-|\w]+)/?.*" type="CLOUD"/>
        <!-- Example Regex to capture user identity in uri
            e.g: /service/usertest1/action => x-pp-user=usertest1
            e.g: /service/853473/action => x-pp-user=853473
            e.g: /service/-741057/action => x-pp-user=-741057
            e.g: /service/reposeuser/action => x-pp-user=reposeuser
            -->
        <!-- <account-mapping id-regex=".*.com/service/([-|\w]+)/?.*" type="MOSSO"/> -->

    </rackspace-auth>

    <% else %>

    <openstack-auth delegable="false" tenanted="true" request-groups="true" token-cache-timeout="600000" group-cache-timeout="600000" xmlns="http://docs.openrepose.org/repose/client-auth/os-ids-auth/v1$
        <identity-service username="<%= @username %>" password="<%= @password %>" tenantId="<%= @tenant_id %>" uri="<%= @auth_uri %>" />

        <% if @mapping_regex %>
        <client-mapping id-regex="<%= @mapping_regex %>"/>
        <% end %>

        <!-- Example Regex to capture user identity in uri
            e.g: /servers/usertest1/action => x-pp-user=usertest1
            e.g: /servers/853473/action => x-pp-user=853473
            e.g: /servers/-741057/action => x-pp-user=-741057
            e.g: /servers/reposeuser/action => x-pp-user=reposeuser
            -->
        <client-mapping id-regex=".*/v1/([-|\w]+)/?.*"/>

        <endpoints-in-header format="XML" cache-timeout="600000" identity-contract-version="2"/>

<!-- TODO(jwood): Support this?
    	<service-admin-roles>
            <role>admin</role>
        </service-admin-roles>
-->
    </openstack-auth>

    <% end %>


</client-auth>
